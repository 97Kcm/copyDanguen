<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dangeun.mapper.ChatMapper">

    <resultMap id="getUserProfile" type="ChatDTO" autoMapping="true">
        <id property="boardNo" column="chat_room_no"/>
        <association javaType="UserDTO" property="userDTO" autoMapping="true" resultMap="com.dangeun.mapper.UserMapper.getUserProfile">
            <id property="email" column="email"/>
        </association>
    </resultMap>

    <resultMap id="getChatTextData" type="ChatDTO" autoMapping="true">
        <id property="chatNo" column="chat_no"/>
        <result property="boardNo" column="chat_room_no"/>
        <collection property="chatTextDTO" ofType="ChatTextDTO" javaType="List" autoMapping="true">
            <id property="no" column="no"/>
        </collection>
    </resultMap>


    <select id="selectAllChatRoomInfo" resultType="ChatDTO" resultMap="getUserProfile">
        SELECT * FROM `chat_room` CR
            INNER JOIN `user` U
            ON CR.chat_user_id = U.email
        WHERE my_id = #{myId} OR chat_user_id = #{myId}
    </select>

    <select id="selectChatRoom" resultType="ChatDTO" resultMap="getUserProfile">
        SELECT * FROM `chat_room` CR
            INNER JOIN `user` U
            ON U.email = CR.chat_user_id
        WHERE chat_room_no = #{boardNo}
    </select>

    <select id="selectChatText" resultType="ChatDTO" resultMap="getChatTextData">
        SELECT * FROM `chat_room` CR
            INNER JOIN `chat_text` CT
            ON CR.chat_room_no = CT.board_no
        WHERE CR.chat_room_no = #{boardNo}
    </select>

    <insert id="insertInfoByChatRoom">
        INSERT INTO `chat_room`
        VALUES
        (NULL, #{boardNo}, #{myId}, #{chatUserId})
    </insert>

    <insert id="insertChatTextData">
        INSERT INTO `chat_text`
        VALUES
        (NULL, #{boardNo}, #{id}, #{nickname}, #{message}, #{nowDate})
    </insert>




</mapper>