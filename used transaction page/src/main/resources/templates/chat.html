<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/chatLayout}"
>
<head>
    <meta charset="UTF-8">
    <title>chat</title>
    <link rel="stylesheet" href="../static/css/chat.css" th:href="@{/css/chat.css}">
    <link rel="stylesheet" href="../static/css/public/public.css" th:href="@{/css/public/public.css}">
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@5.0.0/bundles/stomp.umd.min.js"></script>
    <script src="https://kit.fontawesome.com/3d4b55021f.js" crossorigin="anonymous"></script>
    <script src="../static/js/chat.js" th:src="@{/js/chat.js}" defer></script>
</head>
<body>

    <main layout:fragment="chat">
        <section id="user-icon-section">
            <button>
                <img th:src="${#authentication.principal.getProfileImage.getFileUrl}" alt="또또" src="https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png">
            </button>
        </section>
        <section id="short-chat-section">
            <section id="nickname-section">
                <b th:text="${#authentication.principal.getNickname}">닉네임</b>
                <input type="hidden" id="my-profile" th:value="${#authentication.principal.getProfileImage.getFileUrl}">
                <input id="myNickname" type="hidden" th:value="${#authentication.principal.getNickname}">
                <input id="my-id" type="hidden" th:value="${#authentication.principal.getEmail}">
            </section>
            <section>
                <ul id="short-chat-box" class="scroll">
                    <li th:each="chatInfo : ${chatInfos}">
                        <a th:href="@{/chat(boardNo=${chatInfo.boardNo})}">
                            <div>
                                <img th:src="${chatInfo.getUserDTO().getProfileImage().getFileUrl()}" alt="또또" src="https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png">
                            </div>
                            <div>
                                <div>
                                    <b th:text="${chatInfo.getUserDTO().getNickname()}">닉네임</b>
                                    <input id="otherId" type="hidden" th:value="${chatInfo.getUserDTO().getEmail()}">
                                    <input type="hidden" id="other-profile" th:value="${chatInfo.getUserDTO().getProfileImage().getFileUrl()}">
<!--                                    <span th:text="${chatList.getNowDate()}">시간</span>-->
                                </div>
<!--                                <span th:if="${chatList.getMessage().length() > 10}" th:text="${chatList.getMessage().substring(0,10)}">채팅내용 아무거나</span>-->
<!--                                <span th:if="${chatList.getMessage().length() <= 10}" th:text="${chatList.getMessage()}">채팅내용 아무거나</span>-->
                            </div>
                        </a>
                        <input id="board-no" type="hidden" th:value="${chatInfo.getBoardNo()}">
                    </li>

                </ul>
                <section id="question-section">
                    <a href="">
                        <span>자주 묻는 질문</span>
                        <div>
                            <i class="fa-solid fa-question"></i>
                        </div>
                    </a>
                </section>
            </section>
        </section>
        <section id="chat-section">
            <section  th:each="chatRooms : ${chatInfos}"
                      th:if="${chatRooms.getBoardNo().equals(nowBoardNo)}">
                <section id="chat-nickname-section">
                    <div>
                        <div>
                            <img th:src="${chatRooms.getUserDTO().getProfileImage().getFileUrl()}" alt="또또" src="https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png">
                        </div>
                        <span th:text="${chatRooms.getUserDTO().getNickname()}">닉네임</span>
                    </div>
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </section>
                <section id="chat-area" class="scroll">
                    <section th:each="chat : ${chatList}">
                        <div th:if="${chat.getId() == #authentication.principal.email}" class="opponent-chat">
                            <span th:text="${chat.getNowDate()}">날짜/시간</span>
                            <div th:text="${chat.getMessage()}" class="message">나는 지금 아무말이나 하고있는데 너는 지금 완전 다른짓을 하고 있구나 내말에 집중해주지 않을래</div>
                            <div class="profile">
                                <img th:src="${#authentication.principal.getProfileImage.getFileUrl}" alt="또또" src="https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png">
                            </div>
                        </div>
                        <div th:if="${chat.getId().equals(chatRoom.getChatUserId())}" class="my-chat">
                            <div class="profile">
                                <img th:src="${chatRoom.getUserDTO().getProfileImage().getFileUrl()}" alt="또또" src="https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png">
                            </div>
                            <div th:text="${chat.getMessage()}" class="message">너도 지금 아무말이나 하고있으면서 나는 왜 아무말이나 하면 안된다는 거니 그건 궤변이야 나에게도 아무말을 할 수 있는 기회를 줘</div>
                            <span th:text="${chat.getNowDate()}">날짜/시간</span>
                        </div>
                    </section>
<!--                    <div class="date-section">-->
<!--                        <span>날짜/시간</span>-->
<!--                    </div>-->

                </section>
            </section>
            <section id="chat-input-section">
                <div>
                    <input id="message" type="text">
                    <button id="send-message">보내기</button>
                </div>
            </section>
        </section>
    </main>
</body>
</html>